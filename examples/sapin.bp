sapin : Int -> @String
sapin n =
  let -- base = baseWidth of each section
      base       = (6 + [0..n])^2 // 2 - 11
      stars      = base + (\n. 2*[0..n])@0 $ [0..n]-4
      trunkWidth = 1 + 2 * (1 + (n-1)//2)
      addOffset : n*Int -> [n 2]*Int
      addOffset line = (\x. x ,. x) $ last base//2 - line//2

      tree  = addOffset stars               `choose` " *"
      trunk = [n 2] `shape` addOffset trunk `choose` " |"
  in  tree , trunk
